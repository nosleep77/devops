
podTemplate(yaml: '''
  apiVersion: v1
  kind: Pod
  spec:
    containers:
    - name: centos
      image: centos
      command:
      - sleep
      args:
      - 99d
    restartPolicy: Never
''') {

node(POD_LABEL) {
  stage('k8s') {
    git 'https://github.com/nosleep77/cd-docker-jenkins'

    container('centos') {
      stage('start calculator') {
        sh '''
        TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
        curl --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
        -H "Authorization: Bearer $TOKEN" \
        -X GET "https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT/api/v1/namespaces/jenkins/pods"
        '''
      }
     }
   }

}
}
